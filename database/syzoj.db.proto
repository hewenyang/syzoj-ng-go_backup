syntax = "proto2";

package syzoj.db;

import "gotype.proto";
import "dbmodel.proto";
import "syzoj.model.proto";

option go_package = "github.com/syzoj/syzoj-ng-go/database";

// This file defines all tables in the database.
// Every field is stored as a column, and protobuf fields are stored as a blob field.
// Be careful when editing this file. SQL schemas and any SQL statements in source files
// also need to be updated.

message User {
    optional string id = 1 [(gotype.gotype) = "UserRef"];
    optional string user_name = 2 [(dbmodel.sql) = "user_name varchar(64) UNIQUE"];
    optional syzoj.model.UserAuth auth = 3;
}

message Device {
    optional string id = 1 [(gotype.gotype) = "DeviceRef"];
    optional string user = 2 [(gotype.gotype) = "UserRef"];
    optional syzoj.model.DeviceInfo info = 3;
}

message Problem {
    optional string id = 1 [(gotype.gotype) = "ProblemRef"];
    optional string title = 2;
    optional string user = 3 [(gotype.gotype) = "UserRef"];
}

message ProblemSource {
    optional string id = 1 [(gotype.gotype) = "ProblemSourceRef"];
    optional syzoj.model.ProblemSource source = 16;
}

message ProblemJudger {
    optional string id = 1 [(gotype.gotype) = "ProblemJudgerRef"];
    optional string problem = 2 [(gotype.gotype) = "ProblemRef"];
    optional string user = 3 [(gotype.gotype) = "UserRef"];
    optional string type = 4;
    optional syzoj.model.Any data = 16;
}

message ProblemStatement {
    optional string id = 1 [(gotype.gotype) = "ProblemStatementRef"];
    optional string problem = 2 [(gotype.gotype) = "ProblemRef"];
    optional string user = 3 [(gotype.gotype) = "UserRef"];
    optional syzoj.model.ProblemStatement data = 16;
}

message Submission {
    optional string id = 1 [(gotype.gotype) = "SubmissionRef"];
    optional string problem_judger = 2 [(gotype.gotype) = "ProblemJudgerRef"];
    optional string user = 3 [(gotype.gotype) = "UserRef"];
    optional syzoj.model.Any data = 16;
}
